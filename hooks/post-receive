#!/bin/bash

# Git Hook - Post-receive
# Ce script se déclenche automatiquement après chaque push Git
# Il met à jour automatiquement la version pour déclencher le vidage du cache

echo "=== Git Hook Post-Receive: Début du déploiement ==="

# Naviguer vers le répertoire de l'application
cd /path/to/your/app  # Remplacez par votre chemin réel

# Vérifier si le script de déploiement existe
if [ -f "deploy_version.php" ]; then
    echo "Exécution du script de mise à jour de version..."
    
    # Exécuter le script PHP de déploiement
    php deploy_version.php
    
    if [ $? -eq 0 ]; then
        echo "✅ Version mise à jour avec succès"
        echo "Le cache sera vidé automatiquement pour tous les clients"
    else
        echo "❌ Erreur lors de la mise à jour de version"
        exit 1
    fi
else
    echo "❌ Script deploy_version.php non trouvé"
    exit 1
fi

# Optionnel: Redémarrer les services si nécessaire
# systemctl reload nginx
# systemctl reload php-fpm

echo "=== Git Hook Post-Receive: Déploiement terminé ==="
